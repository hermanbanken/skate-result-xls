{"version":3,"sources":["angular.js","historyTimePlot.js","lapTimePlot.js","loader.js","skaterService.js","skaters.js","skatersCompare.js","skatersResources.js"],"names":["OLD_MINDAYS","angular","module","factory","$resource","get","method","isArray","app","run","$rootScope","$state","$stateParams","$on","console","log","bind","filter","inputArray","showOld","moment","c","starts","isAfter","add","controller","$scope","$http","JSON","parse","localStorage","getItem","venue","discipline","doFilter","old","setItem","stringify","config","$locationProvider","$stateProvider","$urlRouterProvider","$resourceProvider","root","state","url","templateUrl","resolve","meta","Meta","$promise","onEnter","venues","_","uniq","pluck","disciplineTranslations","abstract","template","competitions","Competition","query","states","competition","id","result","CompetitionResult","otherwise","defaults","stripTrailingSlashes","event","toState","toParams","fromState","fromParams","$","modal","error","arguments","$filter","map","groupBy","Date","ends","resultsStatus","list","key","value","countOlder","cs","isBefore","length","skaterService","jump","scrollIntoView","document","body","scrollTop","height","part","passings","chain","results","ts","t","flatten","firstStart","dists","min","buildStart","distance","distanceQuantity","index","start","last","times","time","points","parseTime","name","category","ok","parseInt","replace","sumPoints","u","reduce","s","n","simplifyCols","simple","pick","indexBy","o","buildRank","rank","dist","valueQuantity","values","cols","distances","pairs","hasTotal","every","d","ranks","sortBy","window","wideView","r","refresh","$delete","then","transitionTo","current","reload","inherit","notify","parseDate","dateString","parseSkateTime","skateTime","formatSkateTime","millis","formatTime","data","nodeSelector","labelSelector","titleText","xScale","Plottable","Scales","Time","yScale","Linear","xAxis","Axes","margin","annotationsEnabled","yAxis","Numeric","formatter","names","keys","fillColorScale","legend","Color","domain","Components","Legend","title","TitleLabel","yAlignment","timeline","Plots","Scatter","x","date","y","size","attr","autorangeMode","guideline","GuideLineLayer","scale","group","Group","table","Table","renderTo","Interactions","PanZoom","attachTo","minDomainExtent","maxDomainExtent","Pointer","onPointerMove","p","entity","entityNearest","datum","annotatedTicks","text","onPointerExit","pixelPosition","sort","a","b","p_80f1_1","i","Math","floor","addDataset","Dataset","lapDistances","distanceString","laps","unshift","Category","races","race","localeCompare","slice","bounds","splice","opacity","forEach","append","Line","l","lap_time","$q","Loader","progress","defer","loading","fn","args","Array","prototype","call","total","counter","count","progress_success","errors","progress_error","when","apply","catch","e","finally","promise","wrap","v","reject","MONTH_JUNE","SEASON","getFullYear","getMonth","Function","identity","ageToCategory","age","parseCategory","inSeason","isEnglish","output","multipliers","multi","parts","split","pop","shift","pad","num","us","ss","ms","substr","Skater","hasOwnProperty","birthdate","season","href","link","type","code","remove","service","skaters","indexOf","save","equals","obj","ignoreBirthdate","equal","first_name","last_name","getTime","push","router","views","findresult","SkatersFindResult","onExit","add_skater","compare","compared","$watch","addSkater","model","seasonStart","$d","subtract","RaceService","historyTimePlot","lapTimePlot","skater","find","m","match","prs","memo","best","selected","categories","substring","saveLinks","links","updated","isNaN","ids","alert","go","on","input","indexes","k","flatMap","selector","RaceTime","scopedGet","combine","one","multiple","concat","fetch","recurse","deferred","more","all","subs","mergeSources","extend","Error"],"mappings":"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","file":"all.js","sourcesContent":["const OLD_MINDAYS = -9;\n\nangular.module('skateApp.services', [])\n.factory('Meta', ['$resource', function($resource) {\n\treturn $resource('/api/meta', null);\n}])\n.factory('Competition', ['$resource', function($resource) {\n\treturn $resource('/api/competitions/:id', null);\n}])\n.factory('CompetitionResult', ['$resource', function($resource) {\n\treturn $resource('/api/competitions/:id/result', null, {\n\t\tget: { method: \"GET\", isArray: true }\n\t});\n}]);\n\nvar app = angular.module('skateApp', [\n\t'ngResource',\n\t'ngRoute',\n\t'ui.router',\n\t'angular.filter',\n\t'skateApp.services'\n])\n.run(function ($rootScope, $state, $stateParams) {\n  $rootScope.$on(\"$stateChangeError\", console.log.bind(console));\n\t// It's very handy to add references to $state and $stateParams to the $rootScope\n\t// so that you can access them from any scope within your applications.\n\t$rootScope.$state = $state;\n\t$rootScope.$stateParams = $stateParams;\n});\n\napp.filter('hideOld', function() {\n  return function(inputArray, filter) {\n\t\treturn inputArray.filter(c => {\n\t\t\treturn filter.showOld || moment(c.starts).isAfter(moment().add(OLD_MINDAYS, 'day'));\n\t\t})\n  };\n});\n\napp.controller('appCtrl', [\"$scope\", \"$rootScope\", \"$http\", function ($scope, $rootScope, $http) {\n\t\n\t// Filtering\n\t$rootScope.filter = JSON.parse(localStorage.getItem(\"filter\")) || { venue: null, discipline: null };\n\t$scope.doFilter = function(){\n\t\tvar old = JSON.parse(localStorage.getItem(\"filter\")) || {};\n\t\tif(old.discipline != $rootScope.filter.discipline) {\n\t\t\t$rootScope.filter.venue = null;\n\t\t}\n\t\tlocalStorage.setItem(\"filter\", JSON.stringify($rootScope.filter));\n\t}\n\t$scope.doFilter();\n\n}]);\n\napp.config(function($locationProvider, $stateProvider, $urlRouterProvider, $resourceProvider) {\n\t// Fancy HTML5 url's (no hashes).\n\t//$locationProvider.html5Mode( true );\n\t\n\t// Routes\n\tvar root = $stateProvider;\n\t\n\troot.state(\"root\", {\n\t\turl: \"/\",\n\t\ttemplateUrl: \"partials/welcome.html\",\n\t\tresolve: {\n\t\t\tmeta: function (Meta) {\n\t\t\t\treturn Meta.get().$promise;\n\t\t\t}\n\t\t},\n\t\tonEnter: function($rootScope, $stateParams, meta) {\n\t\t\tlocalStorage.setItem(\"filter\", \"{}\");\n\t\t\t$rootScope.filter = {};\n\t\t\t$rootScope.venues = _.uniq(_.pluck(meta.venues, \"venue\"), \"code\");\n\t\t\t$rootScope.disciplineTranslations = {\n\t\t\t\t\"SpeedSkating.Inline\": \"Inline-skaten\",\n\t\t\t\t\"SpeedSkating.LongTrack\": \"Langebaan\",\n\t\t\t\t\"SpeedSkating.Marathon\": \"Marathon\",\n\t\t\t\t\"SpeedSkating.ShortTrack\": \"Shorttrack\",\n\t\t\t};\n\t\t\t$rootScope.meta = meta;\n    \t\t$rootScope.$stateParams = $stateParams;\n\t\t}\n\t})\n\n\troot.state('competitions', {\n\t\tabstract: true,\n\t\turl: \"/competitions/{discipline:[a-zA-Z]+.[a-zA-Z]+}/{venue:[A-Z]{3}}\",\n\t\ttemplate: \"<ui-view />\",\n\t\tresolve: {\n\t\t\tmeta: function (Meta) {\n\t\t\t\treturn Meta.get().$promise;\n\t\t\t},\n\t\t\tcompetitions: function(Competition, $stateParams){\n\t\t\t\treturn Competition.query({ discipline: $stateParams.discipline, venue: $stateParams.venue }).$promise;\n\t\t\t},\n\t\t},\n\t\tonEnter: function($rootScope, competitions, meta, $stateParams){\n\t\t\t// Populate filter lists\n\t\t\t$rootScope.meta = meta;\n\t\t\tlocalStorage.setItem(\"filter\", JSON.stringify($stateParams));\n\t\t\t$rootScope.filter = $stateParams;\n\t\t\t$rootScope.states = [\"Nog niet bekend\", \"Voorlopig resultaat\", \"Resultaat beschikbaar\"];\n\t\t}\n\t})\n\t\n\troot.state('competitions.list', {\n\t\turl: \"\",\n\t\ttemplateUrl: 'partials/competitions.html',\n\t\tcontroller: 'CompetitionListCtrl',\n\t})\n\t\n\troot.state('competitions.detail', {\n\t\turl: '/:id',\n\t\ttemplateUrl: 'partials/competition.html',\n\t\tcontroller: 'CompetitionDetailCtrl',\n\t\tresolve: {\n\t\t\tcompetition: function(Competition, $stateParams){\n\t\t\t\treturn Competition.get({ id: $stateParams.id }).$promise;\n\t\t\t},\n\t\t\tresult: function(CompetitionResult, $stateParams){\n\t\t\t\treturn CompetitionResult.get({ id: $stateParams.id }).$promise;\n\t\t\t}\n\t\t}\n\t});\n\n\t$urlRouterProvider.otherwise(\"/\");\n\n\t// Don't strip trailing slashes from calculated URLs\n\t$resourceProvider.defaults.stripTrailingSlashes = false;\n});\n\napp.run(function($rootScope){\n\t$rootScope.$on('$stateChangeStart', function(event, toState, toParams, fromState, fromParams){\n\t\t$(\".page-loading .modal\").modal('show');\n\t});\n\t$rootScope.$on('$stateChangeSuccess', function(event, toState, toParams, fromState, fromParams){\n\t\t$(\".page-loading .modal\").modal('hide');\n\t});\n\t$rootScope.$on('$stateChangeError', function(event, toState, toParams, fromState, fromParams, error){\n\t\tconsole.log(\"stateChangeError\", arguments);\n\t\t$(\".page-loading .modal\").modal('hide');\n\t});\n});\n\n//$('<div class=\"progress\"><div class=\"progress-bar progress-bar-striped active\" role=\"progressbar\" style=\"width: 100%\"></div></div>')\n\t\napp.controller('CompetitionListCtrl', [\"$scope\", \"$rootScope\", \"$http\", \"competitions\", \"$filter\", function ($scope, $rootScope, $http, competitions, $filter) {\n\t// Group by availability state\n\t$scope.competitions = _.map(_.groupBy(competitions, function(c) {\n\t\tif(new Date(c.ends) > new Date())\n\t\t\treturn 0;\n\t\treturn c.resultsStatus;\n\t}), function(list, key){\n\t\treturn { state: key, value: list };\n\t});\n\t\n\t$scope.showOld = function(){\n\t\t$rootScope.filter.showOld = true;\n\t}\n\t$scope.countOlder = function(cs) {\n\t\treturn cs.filter(c => moment(c.starts).isBefore(moment().add(OLD_MINDAYS, 'day'))).length;\n\t}\n\n}]);\n\napp.controller('CompetitionDetailCtrl', function ($scope, $state, $stateParams, result, competition, skaterService) {\n\t$scope.jump = function(id){\n\t\t$(\"#\"+id)[0].scrollIntoView()\n\t\tdocument.body.scrollTop -= $(\".navbar\").height() + 10;\n\t}\n\t\n\t$scope.competition = competition;\n\t\n\t$scope.result = result.map(function(part) {\n\t\t// Find distinct list of passings distances available in this competition part\n\t\tpart.passings = _.chain(part.results).pluck(\"times\").map(function(ts) { \n\t\t\treturn ts.map(function(t) { return t[0]; });\n\t\t}).flatten().uniq().value();\n\t\treturn part;\n\t});\n\t\n\tfunction firstStart(dists) {\n\t\treturn _.chain(dists).pluck(\"number\").min().value();\n\t}\n\t\n\t/**\n\t * Convert single skaters result line to reducable object\n\t */\n\tfunction buildStart(distance, distanceQuantity, index, start) {\t\t\n\t\tlet last = _.last(start.times)\n\t\tlet time = last[1]\n\t\tlet points = (skaterService.parseTime(time, true) / distance * 500)\t\n\t\treturn {\n\t\t\tindex,\n\t\t\tdistance,\n\t\t\ttime,\n\t\t\tpoints,\n\t\t\tid: start.name + \":\" + start.category, \n\t\t\tname: start.name,\n\t\t\tcategory: start.category,\n\t\t\tok: distance == parseInt(last[0].replace('m', \"\")) || distanceQuantity !== 0,\n\t\t}\n\t}\n\t\n\tfunction sumPoints(starts) {\n\t\treturn _.chain(starts)\n\t\t\t.filter(u => u.ok)\n\t\t\t.pluck(\"points\")\n\t\t\t.reduce((s,n) => s+n, 0)\n\t\t\t.value();\n\t}\n\t\n\t/**\n\t * Simplify ranking column data\n\t */\n\tfunction simplifyCols(starts) {\n\t\tlet simple = starts.map(s => _.pick(s, \"index\", \"distance\", \"time\", \"ok\"));\n\t\treturn _.indexBy(simple, o => o.index + \"\");\n\t}\n\t\n\t/**\n\t * Maps lists of distance results to rankings\n\t */\n\tfunction buildRank(dists) {\n\t\tvar rank = _.chain(dists)\n\t\t  // make distance result rows groupable \n\t\t\t.map((dist, index) => dist.results.map(buildStart.bind(null, dist.value, dist.valueQuantity, index)))\n\t\t\t.flatten()\n\t\t\t.groupBy(\"id\")\n\t\t\t.values()\n\t\t\t// create ranking row\n\t\t\t.map(starts => ({\n\t\t\t\tcategory: starts[0].category,\n\t\t\t\tcols: simplifyCols(starts),\n\t\t\t\tdistances: starts.filter(s => s.ok).length,\n\t\t\t\tname: starts[0].name,\n\t\t\t\tpoints: sumPoints(starts),\n\t\t\t}))\n\t\t\t.value();\n\t\trank.distances = _.chain(dists).pluck(\"value\").pairs().value();\n\t\trank.name = _.pluck(dists, \"combinationName\")[0];\n\t\trank.id = _.pluck(dists, \"combinationId\")[0];\n\t\trank.hasTotal = _.every(dists, d => d.valueQuantity === 0);\n\t\treturn rank;\n\t}\n\n\t// Create a ranking per combination\n\tvar ranks = _.chain(result)\n\t\t.groupBy(\"combinationId\")\n\t\t.values()\n\t\t.sortBy(firstStart)\n\t\t.map(buildRank)\n\t\t.value();\n\t\n\tconsole.log(\"ranks\", ranks)\n\twindow.ranks = ranks;\n\t\n\t$scope.wideView = !result.every(r => r.valueQuantity != 0 || r.value <= 3000);\n\t\n\t// Reload\n\t$scope.refresh = function() {\n\t\tconsole.log(\"Deleting cache of competition\", competition);\n\t\t$scope.result = [];\n\t\t$scope.ranks = [];\n\t\t\n\t\tcompetition.$delete(competition).then(function(){\n\t\t\tconsole.log(\"Reloading competition\", competition.id);\n\t\t\t$state.transitionTo($state.current, $stateParams, {\n\t\t\t\t\treload: true,\n\t\t\t\t\tinherit: false,\n\t\t\t\t\tnotify: true\n\t\t\t});\n\t\t});\n\t};\n\n\t$scope.ranks = ranks;\t\n\t$scope.competition = competition;\n});","app.factory(\"historyTimePlot\", function(skaterService) {\n\n\tfunction parseDate(dateString) {\n\t\treturn new Date(dateString);\n\t}\n\tfunction parseSkateTime(skateTime) {\n\t\tif(skateTime)\n\t\t\treturn skaterService.parseTime(skateTime);\n\t\treturn;\n\t}\n\tfunction formatSkateTime(millis) {\n\t\treturn skaterService.formatTime(millis);\n\t}\n\n\treturn function(data, nodeSelector, labelSelector, titleText) {\n\t\tvar xScale = new Plottable.Scales.Time();\n\t\tvar yScale = new Plottable.Scales.Linear();\n\t\tvar xAxis = new Plottable.Axes.Time(xScale, \"bottom\")\n\t\t\t.margin(5)\n\t\t\t.annotationsEnabled(true);\n\t\tvar yAxis = new Plottable.Axes.Numeric(yScale, \"left\")\n\t\t\t.margin(5).formatter(formatSkateTime);\n\n\t\tvar names = _.chain(data).groupBy(labelSelector).keys().value();\n\n\t\tvar fillColorScale, legend;\n\t\tif(typeof labelSelector == 'function') {\n\t\t\tfillColorScale = new Plottable.Scales.Color().domain(names);\n\t\t\tlegend = new Plottable.Components.Legend(fillColorScale);\n\t\t} else {\n\t\t\tfillColorScale = \"#0052A5\";\n\t\t}\n\n\t\tvar title = new Plottable.Components.TitleLabel(titleText, 0)\n\t\t\t.yAlignment(\"top\");\n\n\t\tvar timeline = new Plottable.Plots.Scatter()\n\t\t\t.x(function(d) { return parseDate(d.date); }, xScale)\n\t\t\t.y(function(d) { return parseSkateTime(d.time); }, yScale)\n\t\t\t.size(10)\n\t\t\t.attr(\"opacity\", 1)\n\t\t\t.attr(\"stroke-width\", 1)\n\t\t\t.attr(\"fill\", labelSelector, fillColorScale)\n\t\t\t.attr(\"stroke\", \"#ffffff\")\n\t\t\t.autorangeMode(\"y\")\n\t\t\n\t\tvar guideline = new Plottable.Components.GuideLineLayer(\"vertical\")\n\t\t\t.scale(xScale);\n\t\t\n\t\tvar group = new Plottable.Components.Group([guideline, timeline, legend, title]);\n\t\tvar table = new Plottable.Components.Table([[yAxis, group],\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t[null, xAxis]]);\n\t\ttable.renderTo(nodeSelector);\n\t\t\n\t\tnew Plottable.Interactions.PanZoom(xScale, null)\n\t\t\t.attachTo(timeline)\n\t\t\t.minDomainExtent(xScale, 1000 * 60 * 60 * 24 * 365)\n\t\t\t.maxDomainExtent(xScale, 1000 * 60 * 60 * 24 * 365 * 20);;\n\t\t\n\t\tnew Plottable.Interactions.Pointer()\n\t\t\t.attachTo(table)\n\t\t\t.onPointerMove(function(p) {\n\t\t\t\tvar entity = timeline.entityNearest(p);\n\t\t\t\tvar date = parseDate(entity.datum.date);\n\t\t\t\tguideline.value(date);\n\t\t\t\txAxis.annotatedTicks([date]);\n\t\t\t\ttitle.text(entity.datum.date + \" \" + entity.datum.time);\n\t\t\t})\n\t\t\t.onPointerExit(function() {\n\t\t\t\tguideline.pixelPosition(-10);\n\t\t\t\txAxis.annotatedTicks([]);\n\t\t\t\ttitle.text(\"\");\n\t\t\t});\n\n\t\tvar times = data.map(d => d.time).map(parseSkateTime).sort((a,b) => a-b);\n\t\t// Filter times that are larger than 110% of the 90 percentile time,\n\t\t// to filter races where the skater has fallen\n\t\tvar p_80f1_1 = data.filter((d, i) => parseSkateTime(d.time) < 1.1 * times[Math.floor(times.length * .8)]);\n\n\t\ttimeline.addDataset(new Plottable.Dataset(p_80f1_1));\n\t}\n});","app.factory(\"lapTimePlot\", function(skaterService) {\n\n\tfunction parseDate(dateString) {\n\t\treturn new Date(dateString);\n\t}\n\tfunction parseSkateTime(skateTime) {\n\t\tif(skateTime)\n\t\t\treturn skaterService.parseTime(skateTime);\n\t\treturn;\n\t}\n\tfunction formatSkateTime(millis) {\n\t\treturn skaterService.formatTime(millis);\n\t}\n\n\tfunction lapDistances(distanceString) {\n\t\tvar laps = [], d = parseInt(distanceString);\n\t\twhile(d > 0)\n\t\t\tlaps.unshift(d), d -= 400;\n\t\treturn laps;\t\t\n\t}\n\n\treturn function(data, nodeSelector, labelSelector, titleText) {\n\t\tif(!data.length)\n\t\t\treturn;\n\t\n\t\tvar xScale = new Plottable.Scales.Category();\n\t\tvar yScale = new Plottable.Scales.Linear();\n\t\tvar xAxis = new Plottable.Axes.Category(xScale, \"bottom\")\n\t\t\t.margin(5)\n\t\t\t.annotatedTicks(lapDistances(data[0].distance))\n\t\t\t.annotationsEnabled(false);\n\t\tvar yAxis = new Plottable.Axes.Numeric(yScale, \"left\")\n\t\t\t.margin(5).formatter(formatSkateTime);\n\n\t\tvar names = _.chain(data).groupBy(labelSelector).keys().value();\n\n\t\tvar fillColorScale, legend;\n\t\tif(typeof labelSelector == 'function') {\n\t\t\tfillColorScale = new Plottable.Scales.Color().domain(names);\n\t\t\tlegend = new Plottable.Components.Legend(fillColorScale);\n\t\t} else {\n\t\t\tfillColorScale = \"#0052A5\";\n\t\t}\n\n\t\tvar title = new Plottable.Components.TitleLabel(titleText, 0)\n\t\t\t.yAlignment(\"top\");\n\n\t\tvar timeline = new Plottable.Components.Group();\n\n\t\tvar guideline = new Plottable.Components.GuideLineLayer(\"vertical\")\n\t\t\t.scale(xScale);\n\n\t\tvar group = new Plottable.Components.Group([guideline, timeline, legend, title]);\n\t\tvar table = new Plottable.Components.Table([[yAxis, group],\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t[null, xAxis]]);\n\t\ttable.renderTo(nodeSelector);\n\n\t\t// var times = data.map(d => d.time).map(parseSkateTime).sort((a,b) => a-b);\n\t\t// // Filter times that are larger than 110% of the 90 percentile time,\n\t\t// // to filter races where the skater has fallen\n\t\t// var p_80f1_1 = data.filter((d, i) => parseSkateTime(d.time) < 1.1 * times[Math.floor(times.length * .8)]);\n\n\t\tvar races = data\n\t\t\t.filter(race => race.laps)\n\t\t\t.filter(race => race.venue != \"NY\")\n\t\t\t.sort((a,b) => a.time.localeCompare(b.time))\n\t\t\t.slice(0, 10);\n\t\t\n\t\tvar bounds = races.map(race => parseSkateTime(race.time)).sort();\n\t\tbounds.splice(1, bounds.length - 2);\n\t\t\n\t\tfunction opacity(d, i) {\n\t\t\tvar t = parseSkateTime(d.time);\n\t\t\tvar o = .2 + .8 * ((bounds[1] - t) / (bounds[1] - bounds[0]));\n\t\t\treturn o;\n\t\t}\n\n\t\traces.forEach(race => {\n\t\t\ttimeline.append(new Plottable.Plots.Line().addDataset(new Plottable.Dataset(race.laps.filter(l => l.lap_time).sort((a,b) => a.distance - b.distance)))\n\t\t\t\t.x(function(d) { return d.distance; }, xScale)\n\t\t\t\t.y(function(d) { return parseSkateTime(d.lap_time); }, yScale)\n\t\t\t\t//.size(10)\n\t\t\t\t.attr(\"opacity\", opacity(race))\n\t\t\t\t.attr(\"stroke-width\", 2)\n\t\t\t\t//.attr(\"fill\", labelSelector, fillColorScale)\n\t\t\t\t.attr(\"stroke\", fillColorScale.scale(0))\n\t\t\t\t// .autorangeMode(\"y\")\n\t\t\t);\n\t\t})\n\t}\n});","app\n\n.factory('Loader', function($q) {\n\treturn function Loader(name) {\n\t\tvar progress = $q.defer();\n\n\t\tfunction loading(fn) {\n\t\t\tvar args = Array.prototype.slice.call(arguments,1);\n\t\t\tfunction notify() {\n\t\t\t\tprogress.notify({\n\t\t\t\t\tname,\n\t\t\t\t\tprogress: (loading.total - loading.counter) / loading.total, \n\t\t\t\t\tcount: loading.counter, total: loading.total,\n\t\t\t\t\tprogress_success: (loading.total - loading.counter - loading.errors) / loading.total,\n\t\t\t\t\tprogress_error: loading.errors / loading.total,\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn $q.when().then(function(){\n\t\t\t\t\tloading.total++;\n\t\t\t\t\tloading.counter++;\n\t\t\t\t\tnotify();\n\t\t\t}).then(function(){\n\t\t\t\t\treturn fn.apply(null, args);\n\t\t\t}).catch(function(e){\n\t\t\t\tloading.errors++;\n\t\t\t\treturn e;\n\t\t\t}).finally(function(){\n\t\t\t\tloading.counter--;\n\t\t\t\tnotify();\n\t\t\t});\n\t\t}\n\n\t\tloading.total = 0;\n\t\tloading.counter = 0;\n\t\tloading.errors = 0;\n\t\tloading.progress = progress.promise;\n\t\t\n\t\tloading.wrap = function(fn) {\n\t\t\tvar args = Array.prototype.slice.call(arguments,1);\n\t\t\tvar d = $q.defer();\n\t\t\tfn.apply(null, args).then(v => d.resolve(v), e => d.reject(e));\n\t\t\tloading.progress.then(null, null, n => d.notify(n));\n\t\t\treturn d.promise;\n\t\t}\n\n\t\treturn loading;\n\t}\n})","// minus 1 for stupid JavaScript dates\nvar MONTH_JUNE = 5;\nvar SEASON = new Date().getFullYear() + (new Date().getMonth() <= MONTH_JUNE ? -1 : 0);\n\nif(!Function.identity) {\n\tFunction.identity = function(id) { return id; };\n}\n\nfunction ageToCategory(age) {\n\tif(age < 7)\n\t\treturn \"PF\";\n\tif(age < 13)\n\t\treturn \"P\" + (\"FEDCBA\"[age - 7]);\n\tif(age < 19)\n\t\treturn (\"CBA\"[(age - 13) / 2]) + ((age - 13) % 2 + 1);\n\tif(age < 23)\n\t\treturn \"N\" + (age - 19 + 1);\n\tif(age < 30)\n\t\treturn \"SA\";\n\tif(age < 39)\n\t\treturn \"SB\";\n\tif(age < 69)\n\t\treturn \"\" + (40 + Math.floor((age - 39) / 5) * 5);\n\n\treturn \"70\";\n}\n\nfunction parseCategory(date, inSeason) {\n\tif(!date)\treturn;\n\tif(!inSeason) inSeason = SEASON;\n\t\n\tvar age = inSeason - date.getFullYear() - (date.getMonth() <= MONTH_JUNE ? 0 : 1);\n\treturn ageToCategory(age);\n}\n\n/**\n * Parse date format to millis\n */\nfunction parseTime(time, isEnglish) {\n\tvar output = 0;\n\tvar multipliers = [1, 1000, 1000 * 60, 1000 * 3600];\n\tvar multi, part, parts = time.split(/[:,\\.]/g);\n\tif(parts[parts.length-1].length == 2) \n\t\tmultipliers[0] = 10;\n\tdo {\n\t\tpart = parts.pop();\n\t\tmulti = multipliers.shift();\n\t\toutput += multi * parseInt(part);\n\t}\n\twhile (parts.length && multipliers.length);\n\treturn output;\n}\n\nfunction pad(num, size) {\n    var s = num+\"\";\n    while (s.length < size) s = \"0\" + s;\n    return s;\n}\n\nfunction formatTime(millis) {\n  var us = millis % 1000,\n      ss = ((millis - us) / 1000) % 60,\n      ms = ((millis - ss * 1000 - us) / 60000) % 60;\n\treturn (ms > 0 ? (ms + \":\") : \"\") + pad(ss,2) + \".\" + pad(us,3).substr(0,2);\n}\n\napp.factory('skaterService', function() {\n\tfunction Skater(data){\n\t\tfor(var key in data) {\n\t\t\tif(key in Skater.prototype) continue;\n\t\t\tif(!data.hasOwnProperty(key)) continue;\n\t\t\tthis[key] = data[key];\n\t\t}\n\t\tif(this.birthdate)\n\t\t\tthis.birthdate = new Date(this.birthdate);\n\t}\n\t\n\tSkater.prototype.category = function(season) {\n\t\tif(!season) season = SEASON;\n\t\tif(!this.birthdate) return \"?\";\n\t\treturn parseCategory(new Date(this.birthdate), season);\n\t};\n\t\n\tSkater.prototype.href = function(link) {\n\t\tswitch(link.type) {\n\t\t\tcase \"ssr\": return \"http://speedskatingresults.com/index.php?p=17&s=:id\".replace(\":id\", link.code);\n\t\t\tcase \"osta\": return \"http://www.osta.nl/?pid=:id\".replace(\":id\", link.code);\n\t\t\tcase \"knsb\":\n\t\t\tdefault: return \"\";\n\t\t}\n\t};\n\t\n\tSkater.prototype.remove = function(){\n\t\tvar i = service.skaters.indexOf(this);\n\t\tif(i >= 0){\n\t\t\tservice.skaters.splice(i, 1);\n\t\t\tservice.save();\n\t\t}\n\t};\n\t\n\tSkater.prototype.equals = function(obj, ignoreBirthdate){\n\t\tvar equal =\n\t\t\tthis.first_name == obj.first_name && \n\t\t\tthis.last_name == obj.last_name &&\n\t\t\t(ignoreBirthdate || (this.birthdate instanceof Date && this.birthdate.getTime()) == (obj.birthdate instanceof Date && obj.birthdate.getTime()))\n\t\treturn equal;\n\t};\n\n\tvar service = {\n\t\tskaters: (JSON.parse(localStorage.getItem(\"skaters\")) || []).map(data => new Skater(data)),\n\t\tsave: function(){\n\t\t\tlocalStorage.setItem(\"skaters\", JSON.stringify(service.skaters));\n\t\t},\n\t\tadd: function(data){\n\t\t\tservice.skaters.push(new Skater(data));\n\t\t},\n\t\tparseTime: parseTime,\n\t\tformatTime: formatTime,\n\t\tageToCategory: ageToCategory\n\t};\n\t\n\tservice.save();\n  return service;\n});","'use strict';\n\napp.config(function($locationProvider, $stateProvider) {\n\t// Router\n\tvar router = $stateProvider;\n\t\n\trouter.state('skaters', {\n\t\turl: '/skaters',\n\t\tviews: {\t\n\t\t\t'': {\n\t\t\t\ttemplateUrl: 'partials/skaters.html',\n\t\t\t\tcontroller: 'SkatersCtrl'\n\t\t\t},\n\t\t\t'compare@skaters': {\n\t\t\t\ttemplateUrl: 'partials/skaters_compare.html',\n\t\t\t\tcontroller: 'SkatersCompareCtrl',\n\t\t\t\tresolve: {}\n\t\t\t}\n\t\t}\n\t});\n\t\n\trouter.state('skater_single', {\n\t\turl: '/skaters/single?first_name&last_name&birthdate',\n\t\tviews: {\n\t\t\t'': {\n\t\t\t\ttemplateUrl: 'partials/skaters_single.html',\n\t\t\t\tcontroller: 'SkatersSingleCtrl',\n\t\t\t\tresolve: {}\n\t\t\t}\n\t\t}\n\t})\n\t\n\trouter.state('skaters.link', {\n\t\turl: '/link?first_name&last_name&birthdate',\n\t\tviews: {\n\t\t\t'modal@': {\n\t\t\t\ttemplateUrl: 'partials/skaters_link.html',\n\t\t\t\tcontroller: 'SkatersLinkCtrl',\n\t\t\t\tresolve: {\n\t\t\t\t\tfindresult: function(SkatersFindResult, $state, $stateParams){\n\t\t\t\t\t\treturn SkatersFindResult.get({\n\t\t\t\t\t\t\tfirst_name: $stateParams.first_name,\n\t\t\t\t\t\t\tlast_name: $stateParams.last_name,\n\t\t\t\t\t\t\tbirthdate: $stateParams.birthdate\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\tonExit: function(){\n\t\t\t$(\".modal-backdrop\").remove();\n\t\t}\n\t});\n\t\n});\n\napp.controller('SkatersCtrl', function ($scope, $rootScope, $stateParams, skaterService) {\n\t$scope.skaters = skaterService.skaters;\n\t$scope.add_skater = {};\n\t$scope.compare = [];\n\t$rootScope.compared = [];\n\t\n\t$scope.$watch(\"compare\", function(value, old) {\n\t\t$scope.compared = value.map((v,i) => [v,i]).filter(v => v[0]).map(v => v[1]);\n\t}, true);\n\t\n\t// Submit form\n\t$scope.addSkater = function(model){\n\t\tif(model.birthdate) {\n\t\t\tmodel.birthdate = new Date(model.birthdate);\n\t\t}\n\t\tskaterService.add(model);\n\t\t$scope.add_skater = {};\n\t\tskaterService.save();\n\t}\n});\n\nfunction seasonStart(date) {\n\tlet $d = moment(date);\n\tif($d.get('month') + 1 <= 6)\n\t\t$d = $d.subtract(6, 'month');\n\treturn $d.get('year');\n}\n\napp.controller('SkatersSingleCtrl', function ($scope, $rootScope, $stateParams, skaterService, RaceService, historyTimePlot, lapTimePlot) {\n\t$stateParams.birthdate = new Date($stateParams.birthdate);\n\t$scope.skater = skaterService.skaters.find(skater => skater.equals($stateParams, true));\n\t\n\t$scope.progress = 0;\n\t$scope.times = RaceService.get($scope.skater).then(result => {\n\t\twindow.result = result;\n\n\t\t// Show Plots\n\t\t[500, 1000, 1500, 3000, 5000, 10000].forEach(distance => {\n\t\t\thistoryTimePlot(result.times.filter(m => m.distance == distance), \".graph[data-type='history'][data-distance='\"+distance+\"']\", match => match.name);\n\t\t\tif(distance != 500)\n\t\t\t\tlapTimePlot(result.times.filter(m => m.distance == distance), \".graph[data-type='laps'][data-distance='\"+distance+\"']\", match => match.name);\n\t\t})\n\t\t\n\t\t// Show PRs\n\t\tvar prs = _.chain(result.times)\n\t\t\t.groupBy(\"distance\")\n\t\t\t.map(times => _.chain(times)\n\t\t\t\t.sortBy(\"date\")\n\t\t\t\t.reduce((memo, time) => {\n\t\t\t\t\tlet current = parseTime(time.time);\n\t\t\t\t\tif(memo.best == null || memo.best > current) {\n\t\t\t\t\t\tmemo.prs.push(time);\n\t\t\t\t\t\tmemo.best = current;\n\t\t\t\t\t}\n\t\t\t\t\treturn memo;\n\t\t\t\t}, { best: null, prs: [] })\n\t\t\t\t.value())\n\t\t\t.pluck(\"prs\")\n\t\t\t.flatten()\n\t\t\t.sortBy(\"date\")\n\t\t\t.groupBy(t => seasonStart(t.date))\n\t\t\t.value();\n\n\t\t$scope.prs = window.prs = prs;\n\t\tconsole.log(\"window.result\", result, \"window.prs\", prs);\n\t}, e => {\n\t\tconsole.log(\"error\", e);\n\t}, n => {\n\t\t$scope.progress_success = n.progress_success;\n\t\t$scope.progress_error = n.progress_error;\n\t});\n});\n\napp.controller('SkatersLinkCtrl', function ($scope, $state, $stateParams, skaterService, findresult) {\n\tvar birthdate = $stateParams.birthdate = new Date($stateParams.birthdate);\n\t\n\t$scope.skater = skaterService.skaters.find(skater => skater.equals($stateParams));\n\t$scope.skaters = skaterService.skaters;\n\t\n\t// Fill checkboxes when category matches\n\tfindresult.$promise.then(results => {\n\t\t$scope.results = results.map(result => {\n\t\t\tif(birthdate) {\n\t\t\t\tresult.selected = result.categories.every(c => parseCategory(birthdate, c.season) == c.category.substring(1));\n\t\t\t}\n\t\t\treturn result;\n\t\t})\n\t});\n\t\n\t$scope.saveLinks = function(){\n\t\tvar links = $scope.results.filter(r => r.selected);\n\t\tvar updated = skaterService.skaters.filter(skater => skater.equals($stateParams));\n\t\t\n\t\tif(updated.length == 0 && (!$stateParams.birthdate || isNaN($stateParams.birthdate.getTime()))){\n\t\t\tupdated = skaterService.skaters.filter(skater => skater.equals($stateParams, true));\n\t\t}\n\t\t\n\t\tupdated.forEach(skater => { skater.ids = links; });\n\t\tskaterService.save();\n\t\t\n\t\tif(updated.length != 1)\n\t\t\talert(\"Something unexpected happened. Sorry :(\");\n\t\telse\n\t\t\t$state.go(\"^\");\n\t};\n\t\n\t$('.page-modal .modal').modal({}).on('hidden.bs.modal', function (e) {\n\t\t$state.go('^');\n\t});\n});","app.controller('SkatersCompareCtrl', function ($scope, $state, $stateParams, skaterService) {\n\n//\t$rootScope.compared = [];\n\tconsole.log(\"Compare now!\");\n\n});\n\napp.filter('withIndexes', function() {\n  return function(input, indexes) {\n\t\treturn input.filter(function(v, k) {\n\t\t\treturn indexes.indexOf(k) >= 0;\n\t\t});\n  };\n});","if(typeof Array.prototype.flatMap != 'function')\nArray.prototype.flatMap = function(selector) {\n\treturn this.map(selector).reduce(function (memo, list) { \n\t\tmemo.push.apply(memo, list); \n\t\treturn memo;\n\t}, []);\n};\n\napp\n\n.factory('SkatersFindResult', ['$resource', function($resource) {\n\treturn $resource('/api/skaters/find', null, {\n\t\tget: { method: \"GET\", isArray: true }\n\t});\n}])\n\n.factory('RaceTime', function($resource) {\n\treturn $resource('/api/skaters/:type/:code', null);\n})\n\n.factory('RaceService', function($q, RaceTime, $resource, Loader) {\n\t\n\tfunction scopedGet(input) {\n\t\tvar loading = Loader(\"races\")\n\t\t\n\t\t// !Scoped Functions!\n\t\n\t\tfunction combine(one, multiple) {\n\t\t\treturn { \n\t\t\t\ttimes: (one && one.times || []).concat(multiple.flatMap(s => s.times)), \n\t\t\t\terrors: (one && one.errors || []).concat(multiple.flatMap(s => s.errors))\n\t\t\t};\n\t\t}\n\t\t\n\t\tfunction fetch(url) {\n\t\t\treturn loading(() => $resource(url).get().$promise)\n\t\t\t\t.then(recurse, (error) => {\n\t\t\t\t\treturn $q.resolve({ times: [], errors: [error.data] });\n\t\t\t\t});\n\t\t}\n\t\t\n\t\tfunction recurse(data) {\n\t\t\tvar deferred = $q.defer();\n\t\t\t// If we have more\n\t\t\tif(Array.isArray(data.more)) {\n\t\t\t\treturn $q\n\t\t\t\t\t.all(data.more.map(fetch))\n\t\t\t\t\t.then(subs => combine(data, subs));\n\t\t\t}\n\t\t\t// No more\n\t\t\telse {\n\t\t\t\tdeferred.resolve({ times: data.times, errors: [] });\n\t\t\t}\n\t\t\t\n\t\t\treturn deferred.promise;\n\t\t}\n\t\t\n\t\tfunction mergeSources(data) {\n\t\t\tdata.times = _\n\t\t\t\t.chain(data.times)\n\t\t\t\t// Join by day - might be not good enough\n\t\t\t\t.groupBy(m => m.date + \"|\" + m.distance + \"|\" + m.time)\n\t\t\t\t// Merge\n\t\t\t\t.map(t => _.extend.bind(_, {}).apply(_, t))\n\t\t\t\t.sortBy(m => m.date)\n\t\t\t\t.value();\n\t\t\treturn data;\n\t\t}\n\t\n\t\t// !Actual processing!\n\t\t\n\t\tfunction get(input) {\n\t\t\t// Skater\n\t\t\tif(input.ids) {\n\t\t\t\treturn $q\n\t\t\t\t\t.all(input.ids.map(get))\n\t\t\t\t\t.then(list => combine(null, list))\n\t\t\t\t\t.then(mergeSources);\n\t\t\t}\n\t\t\t\n\t\t\tif(!input.type || !input.code)\n\t\t\t\treturn $q.reject(new Error(input, \"is is not a linkable id\"));\n\t\t\t\n\t\t\t// Linkable service\n\t\t\treturn loading(() => RaceTime.get({ type: input.type, code: input.code }).$promise)\n\t\t\t\t.then(recurse);\n\t\t}\n\t\t\n\t\t// Wrap so this promise notifies progress\n\t\treturn loading.wrap(get, input);\n\t}\n\n\treturn {\n\t\tget: scopedGet\n\t};\n\n});"]}