<!DOCTYPE html>
<html>
	<head>
		<title>Result extracter</title>
		<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.8.3/underscore-min.js"></script>
	</head>
	<body>
		<script>
			var disciplines = {
				"SpeedSkating.Inline": "Skeeleren",
				"SpeedSkating.LongTrack": "Langebaan schaatsen",
				"SpeedSkating.Marathon": "Marathon schaatsen",
				"SpeedSkating.ShortTrack": "Short Track schaatsen"
			};

			var body = $("body");
			window.xhr = $.getJSON("/competitions", function (competitions) {

				// Get only past matches
				// c.map(c => new Date(c.starts)).filter(d => d < new Date());

				console.log(competitions);
				window.c = competitions;
				var grouped = _.groupBy(competitions, "discipline");
				Object.keys(grouped).forEach(function (d) {
					$("<h1></h1>").text(disciplines[d]).appendTo(body);
					grouped[d].sort(function(a,b){ return a.starts.localeCompare(b.starts) });
					var lis = grouped[d].map(function (c) {
						console.log(c.id, c.name);
						var a = $("<a></a>").attr("href", "https://inschrijven.schaatsen.nl/#/wedstrijd/"+c.id+"/informatie").text(c.name);
						var li = $("<li></li>");
						a.appendTo(li);
						li.append(" - ");
						$("<a></a>").attr("href", "/competitions/"+c.id+"/results").text("results").appendTo(li);
						li.append(" - ");
						$("<a></a>").attr("href", "http://emandovantage.com/api/competitions/"+c.id+"/reports/Results/5").text("original").appendTo(li);
						return li;
					});
					$("<ul />").append(lis).appendTo(body);
				})
			}).fail(function(xhr, e) {
				console.error("Error", e);
			})
		</script>
	</body>
</html>
	